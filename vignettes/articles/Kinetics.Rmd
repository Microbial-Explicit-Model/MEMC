---
title: "Kinetics"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Objective 

The purpose of this example is to explore the different kinetics or dynamics that can be selected to alter the model configurations. 

## Set Up 

```{r setup}
library(ggplot2)  # package used to visualize results 
library(knitr)    # makes nice tables
library(magrittr) # import the %>% pipeline

library(MEMC)     # MEMC should already be installed, see installation instructions. 

theme_set(theme_bw())  # set a theme to use in all the plots
```



# Microbial Biomass Decay

The `MEMC` package offers soil carbon modelers two options, linear decay and density dependent decay, of microbial biomass (MB) based o [Wang et. al 2013](https://doi.org/10.1890/12-0681.1). 


## Compare linear and density dependent decay 

```{r}
params <- MEMC::default_params
state  <- MEMC::default_initial
time   <- seq(from = 1, to = 3000, by = 10)
```

```{r}
# Set up the model with the LM decay, note this is the default set up and dd.beta is set to a value of 1.
MBdecay_LM <- configure_model(params, state, carbon_pools, carbon_fluxes, MBdecay = "LM", 
                              name = "LM decay")
```


```{r}
# Change the dd.beta parameter (the parameter that controls the strength of the
# density-dependent relationship to a value not equal to 1) 
new_params <- 2
names(new_params) <- "dd.beta"

dd_table <- update_params(new_params, params)
MBdecay_DD <- configure_model(dd_table, state, carbon_pools, carbon_fluxes, MBdecay = "DD", name = "DD decay")
```


```{r}
# Solve the two models
out1 <- solve_model(MBdecay_LM, time)

out2 <- solve_model(MBdecay_DD, time)
out2$param <- 2

out <- rbind(out1, out2, fill = TRUE)
```

```{r}
out %>% 
  ggplot(aes(time, value, color = name)) + 
  geom_line() + 
  facet_wrap("variable", scales = "free") + 
  labs(title = "Linear vs Density Dependent Decay", 
       y = unique(out$units), 
       x = "Title") + 
  theme(legend.title = element_blank())
