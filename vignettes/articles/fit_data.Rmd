---
title: "Fit Data"
---

<!---- 

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, warning = FALSE, message=FALSE}
# Load the packages for this example
library(MEMC)
library(ggplot2)
library(data.table)
```


Load the example observations and the initial state values. 

```{r, warning=FALSE, message=FALSE}
# Import the observations
obs <- read.csv(system.file("example/example_data.csv", package = "MEMC"))

# Select the time 0 observations for the initial state. 
obs_state <- as.numeric(obs[obs$time == 0, names(default_initial)])
names(obs_state) <- names(default_initial)
t <- 0:365

# Select the IC observations to use in the model fit. 
# Get the average of 
IC_obs <- as.data.table(obs[obs$time != 0, c("time", "IC")])
IC_obs <- IC_obs[, list(IC = mean(IC)), by = time]
```



```{r}


mod <- MEND_model
mod$state <- obs_state
to_fit <- c(V.d = 2, V.p = 5, V.m = 0.01)

mend_fit <- memc_modfit(mod = mod, obs = IC_obs, x = to_fit, upper = c(100, 100, 100))


ptable <- update_params(new_params = mend_fit$par, param_table = MEND_model$params)
mend_fit_results <- solve_model(MEND_model, time = t, params = ptable)


ggplot() + 
  geom_line(data = mend_fit_results[variable == "IC", ], aes(time, value, color = "MEND fit")) + 
  geom_point(data = IC_obs, aes(time, IC))

```

----> 

