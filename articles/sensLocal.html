<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Local Senstivity Analysis • MEMC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Local Senstivity Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MEMC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/Manual.html">Mannual</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples">
<li><a class="dropdown-item" href="../articles/ModelComparison.html">Run all model configurations</a></li>
    <li><a class="dropdown-item" href="../articles/sensLocal.html">Local sensitivity analysis</a></li>
    <li><a class="dropdown-item" href="../articles/sensRange.html">Global sensitivity analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JGCRI/hector"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Local Senstivity Analysis</h1>
            
      

      <div class="d-none name"><code>sensLocal.Rmd</code></div>
    </div>

    
    
<p>The objective of this example is demonstrate how to use
<code>memc_sensfun</code> to conduct a local sensitivity analysis and
visualize the results to demonstrate package capabilities.</p>
<p>The <code>memc_sensfun</code> function is a wrapper for
<code>sensFun</code> from the FME package, designed to help
<code>memc</code> users easily perform a local sensitivity analysis on
any <code>memc</code> parameter or initial condition. The official <a href="https://cran.r-project.org/web/packages/FME/FME.pdf" class="external-link">FME</a>
provides more details, but in short, <code>memc_sensfun</code> runs a
memc configuration multiple times: first as a reference run, then as a
series of perturbation runs—one for each parameter of interest. During
each perturbation run, a single parameter is changed slightly while
others remain constant. The output of <code>memc_sensfun</code> includes
the numerical approximations of partial derivatives, representing the
sensitivity of the model output to each perturbed parameter.</p>
<p>Start by loading the packages used in the demonstration.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://microbial-explicit-model.github.io/MEMC">MEMC</a></span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Select the <code>memc</code> parameters or initial conditions to
include in the local sensitivity analysis. Any of the parameters
included in <code>memc_params</code> or <code>memc_initial_state</code>
may be considered. In this example we will consider how the memc MEND
configuration is sensitive to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>d</mi></msub><annotation encoding="application/x-tex">V_d</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>d</mi></msub><annotation encoding="application/x-tex">K_d</annotation></semantics></math>,
the maximum and half saturation rates of DOM decomposition.</p>
<p>Create a vector of the parameter values of interest, the ones we
would like to consider in the local sensitivity analysis and set equal
to the the parameter values used by the <code>memc_config</code> that
will be used to run <code>memc_sensfun</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_to_perturb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"V_d"</span> <span class="op">=</span>  <span class="fl">3</span>, <span class="st">"K_d"</span> <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
<p>Run the local sensitivity analysis for a memc configuration. The
<code>config</code> may be any of the default configuraitons listed in
<code>memc_all_configs</code> or one created by a user via
<code>memc_configure</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/memc_sensfun.html">memc_sensfun</a></span><span class="op">(</span>config <span class="op">=</span> <span class="va">MEND_config</span>,     </span>
<span>                     t <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                     x <span class="op">=</span> <span class="va">params_to_perturb</span><span class="op">)</span></span></code></pre></div>
<p>The returned data frame includes details about the simulation, such
as its name, time, and pool. The value column contains the partial
derivative of the simulation output with respect to the perturbed
parameter, which is specified in the parameter column.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span>
<span><span class="co">#&gt;      name  time variable parameter        value</span></span>
<span><span class="co">#&gt;    &lt;char&gt; &lt;num&gt;   &lt;char&gt;    &lt;fctr&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   MEND     0      POM       V_d  0.000000000</span></span>
<span><span class="co">#&gt; 2:   MEND     1      POM       V_d  0.048743867</span></span>
<span><span class="co">#&gt; 3:   MEND     2      POM       V_d  0.033570845</span></span>
<span><span class="co">#&gt; 4:   MEND     3      POM       V_d  0.015965606</span></span>
<span><span class="co">#&gt; 5:   MEND     4      POM       V_d  0.004513539</span></span>
<span><span class="co">#&gt; 6:   MEND     5      POM       V_d -0.001963303</span></span></code></pre></div>
<p>Quickly plot the results to compare how parameter perturbations
affect model output across all pools throughout the simulation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span></code></pre></div>
<p><img src="sensLocal_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Now let’s apply <code>memc_sensfun</code> to an other model
configuration so that we may compare the results.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/memc_sensfun.html">memc_sensfun</a></span><span class="op">(</span>config <span class="op">=</span> <span class="va">CORPSE_config</span>,     </span>
<span>                     t <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                     x <span class="op">=</span> <span class="va">params_to_perturb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span></code></pre></div>
<p><img src="sensLocal_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Figures 1 and 2 are quite different from one another, let’s focus on
the DOM and IC pools in a side by side comparison. But first recall what
is different between these two configurations. By taking a look at their
configuration tables. It appears that these models differ in how the
represent DOM uptake and POM decomposition.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">MEND_config</span><span class="op">$</span><span class="va">table</span>, </span>
<span>      <span class="va">CORPSE_config</span><span class="op">$</span><span class="va">table</span><span class="op">)</span></span>
<span><span class="co">#&gt;    model DOMuptake POMdecomp MBdecay</span></span>
<span><span class="co">#&gt; 1   MEND        MM        MM      LM</span></span>
<span><span class="co">#&gt; 2 CORPSE       RMM        LM      LM</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save results for the two carbon pools are we are interested in. </span></span>
<span><span class="va">out1_to_compare</span> <span class="op">&lt;-</span> <span class="va">out1</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DOM"</span>, <span class="st">"IC"</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">out2_to_compare</span> <span class="op">&lt;-</span> <span class="va">out2</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DOM"</span>, <span class="st">"IC"</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Combine into a single data frame for plotting </span></span>
<span><span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">out1_to_compare</span>, <span class="va">out2_to_compare</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot the results </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">to_plot</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span>, linetype <span class="op">=</span> <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">~</span> <span class="va">parameter</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y  <span class="op">=</span> <span class="st">"Difference in Output"</span>, x <span class="op">=</span> <span class="st">"Time (days)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sensLocal_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>The figure above demonstrate how MEND and CORPSE ROM and IC pools
respond differently to parameter perturbations.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kalyn Dorheim, Jianqiu Zheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
